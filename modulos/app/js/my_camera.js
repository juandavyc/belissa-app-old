function fun_camera_photo(e,t,n){let a=!1;$("#main").show(),$("#container-camera").hide(),$("#container-filechooser").hide(),$("#camera_video").hide(),$("#camera_canvas").hide();let o=!1,i=document.getElementById("camera_video"),r=document.getElementById("camera_canvas"),c=r.getContext("2d"),s=!1,l=t,d=n,p="",u="";new Image;let f=window.innerWidth-100,m=window.innerHeight-300;function h(){f>700?(i.setAttribute("width",f/1.8),i.setAttribute("height",m),r.setAttribute("width",f/1.8),r.setAttribute("height",m)):(i.setAttribute("width",f),i.setAttribute("height",m),r.setAttribute("width",f),r.setAttribute("height",m))}function v(){var e,t;let n,a=(e=r,t=event,n=e.getBoundingClientRect(),{x:t.clientX-n.left,y:t.clientY-n.top});c.beginPath(),c.moveTo(a.x,a.y),s=!1}function b(e){s||(c.lineTo(e.pageX-r.offsetLeft,e.pageY-r.offsetTop),c.stroke())}function g(e){s||(b(e),s=!0)}function _(e){!0==e?!1==o?navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1}).then(function(e){$("#input-camera-flash").prop("checked",!1),i.srcObject=e;let t=e.getVideoTracks()[0];$("#input-camera-flash").on("change",function(){try{var e,n;e=t.getCapabilities(),n=$(this).is(":checked"),e.torch?t.applyConstraints({advanced:[{torch:n}]}).catch(e=>console.log(e)):$.alert("Sin soporte para flash")}catch(a){$.alert("Camera no compatible con flash")}}),o=!0,i.play(),z(1)}).catch(function(e){$.alert("An error occurred: "+e),o=!1}):$.alert("La camara ya esta encendida"):!0==o?i.srcObject.getTracks().forEach(function(e){e.stop(),o=!1,z(2)}):o=!1}function z(e){1==e?($("#btn-camera-on").prop("disabled",!0),$("#btn-camera-off").prop("disabled",!1),$("#btn-camera-upload").prop("disabled",!0),$("#btn-camera-reload").prop("disabled",!0),$("#btn-camera-take").prop("disabled",!1),$("#camera_video").removeClass("camera_video_off").addClass("camera_video_on"),$("#camera_video").show(),$("#camera_canvas").hide()):2==e?($("#btn-camera-on").prop("disabled",!1),$("#btn-camera-off").prop("disabled",!0),$("#btn-camera-upload").prop("disabled",!0),$("#btn-camera-reload").prop("disabled",!0),$("#btn-camera-take").prop("disabled",!0),$("#camera_video").removeClass("camera_video_on").addClass("camera_video_off"),$("#camera_video").hide(),$("#camera_canvas").show()):3==e&&($("#btn-camera-on").prop("disabled",!1),$("#btn-camera-off").prop("disabled",!0),$("#btn-camera-upload").prop("disabled",!1),$("#btn-camera-reload").prop("disabled",!1),$("#btn-camera-take").prop("disabled",!0),$("#camera_video").removeClass("camera_video_on").addClass("camera_video_off"),$("#camera_video").hide(),$("#camera_canvas").show())}return"http:"===window.location.protocol?(document.querySelector("body").classList.remove("is-preload","landing"),$("body").html('<section class="wrapper style4 container small"><div class="row gtr-50 gtr-uniform"><div class="col-12 align-center"> <h2>Se requiere <b class="https_green">HTTPS</b></h2> </div><div class="col-12 align-center"> <label> Este m\xc3\xb3dulo requiere HTTPS, para poder usar servicios de c\xc3\xa1mara. <a href="https://es.wikipedia.org/wiki/Protocolo_seguro_de_transferencia_de_hipertexto" target="_blank">\xc2\xbfQue es HTTPS?</a> <br>Video de como activar <b class="https_green">HTTPS</b></label></div><div class="col-8 col-12-mobilep align-center"></div><div class="col-4 col-12-mobilep align-left"><div class="row gtr-50 gtr-uniform"><div class="col-12 align-center"><a class="button primary small fit" href="javascript:history.back()"> VOLVER </a></div><div class="col-12 align-center"><a class="button primary small fit" href="'+e+'" > USAR HTTPS </a></div></div></div></div></section>'),a=!1):(a=!0,dropzone_start({id_container:"dropzone-xdxd",id_input:"form_dropzone",limit_input:1,message:"SELECCIONE O ARRASTRE EL ARCHIVO AQUI",folder:"archivos"})),h(),$(window).on("#main",function(){h()}),r.addEventListener("touchstart",function e(t){v(t.touches[0])},!1),r.addEventListener("touchmove",function e(t){b(t.touches[0]),t.preventDefault()},!1),r.addEventListener("touchend",function e(t){g(t.changedTouches[0])},!1),r.addEventListener("mousedown",v,!1),r.addEventListener("mousemove",b,!1),r.addEventListener("mouseup",g,!1),document.getElementById("input-camera-color").onchange=function(){c.strokeStyle=this.value},$(".btn-photo-take").on("click",function(e){return _(!0),$("#main").hide(),$("#container-camera").show(),e.preventDefault(),!1}),$(".cbx-camera").change(function(e){return this.checked?$("#"+$(this).attr("button-id")).attr("disabled",!0):$("#"+$(this).attr("button-id")).attr("disabled",!1),e.preventDefault(),!1}),$(document).on("click",".btn-camera-show",function(e){let t=$(this).attr("data-id");return $.confirm({title:"Alerta",content:"<center> Desea visualizar este contenido en ?</center>",typeAnimated:!0,scrollToPreviousElement:!1,scrollToPreviousElementAnimate:!1,columnClass:"xsmall",closeIcon:!0,buttons:{esta:{text:"Esta pesta\xc3\xb1a",action:function(){window.location.href=PROTOCOL_HOST+"/"+$("#"+t).val()}},otra:{text:"Otra pesta\xc3\xb1a",action:function(){window.open(PROTOCOL_HOST+"/"+$("#"+t).val())}}}}),e.preventDefault(),!1}),$("#btn-camera-on, #btn-camera-reload").on("click",function(e){return _(!0),e.preventDefault(),!1}),$("#btn-camera-off").on("click",function(e){return _(!1),e.preventDefault(),!1}),$("#btn-camera-take").on("click",function(e){return!0==o?(c.clearRect(0,0,r.width,r.height),c.beginPath(),c.drawImage(i,0,0,i.width,i.height),c.lineWidth=4,c.lineJoin="miter",c.strokeStyle=$("#input-camera-color").val(),i.srcObject.getTracks().forEach(function(e){e.stop()}),_(!1),z(3)):$.alert("La camara no esta encendida."),e.preventDefault(),!1}),$(document).on("click",".btn-camera-open",function(e){return p=$(this).attr("input-id"),u=$(this).attr("data-folder"),c.strokeStyle="#E34936",$("#main").hide(100),$("#container-filechooser").hide(100),$("#container-camera").show(100),$("#input-camera-color").val("#E34936"),_(!0),e.preventDefault(),!1}),$("#btn-camera-upload").on("click",function(e){return function e(){let t=1;if(!0==o)$.alert("La camara aun esta encendida");else{let n=$.confirm({title:"Espere... ",content:"Cargando, espere...",typeAnimated:!0,scrollToPreviousElement:!1,scrollToPreviousElementAnimate:!1,content:function(){return $.ajax({url:PROTOCOL_HOST+"/modulos/app/php/call_camera_upload.php",type:"POST",data:{camera_image_base64:r.toDataURL(),camera_image_folder:u,camera_image_id:l,camera_image_rotate:d},headers:{"csrf-token":$('meta[name="csrf-token"]').attr("content")},dataType:"json",timeout:3e4}).done(function(a){"bien"===a.status?(n.setTitle(a.status),n.setContentAppend("<center><b>Imagen guardada</b> </center>"),$("#"+p+"_img").attr("src",a.src),$("#"+p).val(a.src),$("#main").show(),$("#container-camera").hide(),t=2,setTimeout(function(){n.close()},1e3)):"csrf"===a.status||"session"===a.status?(n.close(),call_recuperar_session(e)):(n.setTitle(a.status),n.setContentAppend(a.message))}).fail(function(e){n.setTitle("Error fatal"),n.setContent(e.statusText+" // "+e.responseText),console.log(e)})},buttons:{aceptar:function(){}},onClose:function(){$("html, body").animate({scrollTop:$("#"+p).offset().top-140},500)}})}}(),e.preventDefault(),!1}),$("#btn-camera-exit").on("click",function(e){return $.confirm({title:!1,content:"<center>\xc2\xbfEsta seguro que desea cerrar la camara?</center>",boxWidth:"365px",useBootstrap:!1,buttons:{Si:{action:function(){_(!1),z(2),$("#container-camera").hide(),$("#main").show(),setTimeout(function(){$("html, body").animate({scrollTop:$("#"+p).offset().top-140},500)},500)}},No:{keys:["N"],action:function(){}}}}),e.preventDefault(),!1}),a}let dropzone_id_input="",dropzone_file_folder="",hidden_input_value={status:"sin_archivos",file:[]};function dropzone_start(e){let t=["application/x-zip-compressed","text/plain","application/pdf","application/msword","application/vnd.ms-excel","application/vnd.ms-powerpoint","image/jpeg","image/png",];$("#"+e.id_input).attr("data-limit",e.limit_input),$("#"+e.id_container+" .dropzone-wrapper").prepend(`<div class="dropzone-message"><i class="fas fa-cloud-upload-alt fa-2x"></i><p>${e.message}</p><button class="primary small" id="btn-trigger-input">Seleccionar</button></div>`),$("#"+e.id_container).append('<div class="row gtr-50 gtr-uniform dropzpone-preview" id="'+e.id_container+'_preview_zone"></div> '),$("#"+e.id_container).append('<div class="dropzpone-control"><div class="row gtr-25 gtr-uniform"><div class="col-6 col-12-mobilep"><button class="button primary small fit btn-guardar-dropzone" disabled> Guardar </button></div><div class="col-6 col-12-mobilep"><button class="button primary small fit btn-limpiar-dropzone"> Corregir </button></div><div class="col-6 col-12-mobilep"><button class="button primary small fit btn-formatos-dropzone"> Ayuda </button></div><div class="col-6 col-12-mobilep"><button class="button primary small fit btn-salir-dropzone"> Salir </button></div></div></div>'),$("#"+e.id_container+" .dropzone-wrapper").on("dragover",function(e){$(this).addClass("dragover"),e.preventDefault(),e.stopPropagation()}),$("#"+e.id_container+" .dropzone-wrapper").on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(this).removeClass("dragover")}),$("#"+e.id_container+" .dropzone-wrapper").on("drop",function(n){let a=document.getElementById("form_dropzone");dropzone_reset(e.id_container+"_preview_zone","",hidden_input_value),a.files=n.originalEvent.dataTransfer.files,a.files.length>0?a.files.length<=e.limit_input?(drop_zone_temp_files(a,e.id_container,t),$("#"+e.id_container+" .dropzone-wrapper").hide()):($.alert("Numero de archivos no permitido"),dropzone_reset(e.id_container,e.id_input,hidden_input_value)):($.alert("Ning\xc3\xban archivo seleccionado"),dropzone_reset(e.id_container,e.id_input,hidden_input_value)),n.preventDefault(),n.stopPropagation()}),$("#"+e.id_input).change(function(){dropzone_reset(e.id_container+"_preview_zone","",hidden_input_value),$(this).prop("files").length>0?$(this).prop("files").length<=e.limit_input?(drop_zone_temp_files(this,e.id_container,t),$("#"+e.id_container+" .dropzone-wrapper").hide()):($.alert("Numero de archivos no permitido"),dropzone_reset(e.id_container,e.id_input,hidden_input_value)):($.alert("Ning\xc3\xban archivo seleccionado"),dropzone_reset(e.id_container,e.id_input,hidden_input_value))}),$("#"+e.id_container+" #btn-trigger-input").on("click",function(e){return $("#form_dropzone").click(),e.preventDefault(),!1}),$("#"+e.id_container+" .btn-limpiar-dropzone").on("click",function(t){return dropzone_reset(e.id_container,e.id_input,hidden_input_value),t.preventDefault(),!1}),$("#"+e.id_container+" .btn-formatos-dropzone").on("click",function(e){return $.alert("<b>Formatos permitidos</b> <br>"+t.join("<br>")),e.preventDefault(),!1}),$("#"+e.id_container+" .btn-salir-dropzone").on("click",function(e){return $("#main").show(100),$("#container-camera").hide(100),$("#container-filechooser").hide(100),setTimeout(function(){$("html, body").animate({scrollTop:$("#"+dropzone_id_input).offset().top-120},200)},500),e.preventDefault(),!1}),$("#"+e.id_container+" .btn-guardar-dropzone").on("click",function(t){let n=0;return function t(){if(n<$("#"+e.id_input).prop("files").length){var a;let o,i;a=function(a){n++,t($("#"+e.id_input).prop("files")[n])},(o=new FormData).append("file",$("#"+e.id_input).prop("files")[n]),o.append("folder",dropzone_file_folder),i=$.confirm({title:"Espere... ",content:"Cargando, espere...",typeAnimated:!0,scrollToPreviousElement:!1,scrollToPreviousElementAnimate:!1,content:function(){return $.ajax({url:PROTOCOL_HOST+"/modulos/app/php/call_upload_file.php",dataType:"json",type:"POST",data:o,contentType:!1,cache:!1,processData:!1,headers:{"csrf-token":$('meta[name="csrf-token"]').attr("content")},timeout:3e4}).done(function(e){"bien"===e.status?(hidden_input_value.status="con_archivos",hidden_input_value.file.push({src:e.src,name:e.name,size:e.size}),a(e),i.close()):(i.title(e.status),i.title(e.message))}).fail(function(e){i.setTitle("Error fatal"),i.setContent(e.statusText+" // "+e.responseText)})},buttons:{aceptar:function(){}},onDestroy:function(){}})}else drop_zone_show_files(hidden_input_value,e.id_container,!0)}(),t.preventDefault(),!1})}function drop_zone_temp_files(e,t,n){let a={file:[]},o="";$.each($(e).prop("files"),function(e,t){n.includes(t.type)?t.size<4e7?a.file.push({src:!1,name:t.name,size:t.size}):(o+="archivo: "+escapehtmljs(slice_smart(t.name,20,17))+"<br>",o+="error: <b>pesa mas de 40mb </b><br>"):(o+="archivo: "+escapehtmljs(slice_smart(t.name,20,17))+"<br>",o+="error: <b>Extensi\xc3\xb3n no admitida </b> <br>")}),o.length>0?($.alert(o),dropzone_reset(t,e.id,"")):($("#"+t+" .btn-guardar-dropzone").prop("disabled",!1),drop_zone_show_files(a,t,!1))}function dropzone_reset(e,t,n,a){hidden_input_value={status:"sin_archivos",file:[]},$("#"+e+"_preview_zone").empty(),$("#"+e+" .dropzone-wrapper").removeClass("dragover"),$("#"+e+" .dropzone-wrapper").show(),t.length,$("#"+e+" .btn-guardar-dropzone").prop("disabled",!0)}function drop_zone_show_files(e,t,n){let a='<div class="col-12 align-center"> ';!0==n?(a+='<h3 style="color:#242424;font-weight:bold;"> Archivos subidos correctamente </h3>',$("#"+t+" .dropzone-wrapper").hide(),$("#"+t+" .btn-guardar-dropzone").prop("enable",!0),$("#"+dropzone_id_input).val(e.file[0].src),("PNG"===get_file_extension(e.file[0].src).toUpperCase()||"JPG"===get_file_extension(e.file[0].src).toUpperCase()||"JPEG"===get_file_extension(e.file[0].src).toUpperCase())&&$("#"+dropzone_id_input+"_img").attr("src",e.file[0].src)):a+='<label class="icon solid fa-check-double"> Listado de archivos a subir </label> ',a+="</div>",$.each(e.file,function(e,t){a+='<div class="col-6 col-12-small dropzone-temp-file"><div class="dropzone-temp-icon">'+set_file_icon(get_file_extension(t.name))+'</div><div class="dropzone-temp-description"><p><b> Nombre : </b>'+escapehtmljs(slice_smart(t.name,20,17))+"<b> | "+get_file_extension(t.name).toUpperCase()+" | </b><br><b> Size : </b>"+escapehtmljs(get_file_exact_size(t.size))+"<br><b> URL : </b>",!1==t.src?a+=" ARCHIVO_SIN_SUBIR":a+='<a href="'+PROTOCOL_HOST+"/"+t.src+'" target="_blank"> CLICK PARA VER ARCHIVO </a>',a+="</p></div></div>"}),$("#"+t+"_preview_zone").html(a)}function get_file_extension(e){var t=/^.+\.([^.]+)$/.exec(e);return null==t?".null":t[1]}function set_file_icon(e){let t="";return"txt"==e.toLowerCase()?'<i class="fas fa-file-alt fa-3x"></i>':"zip"==e.toLowerCase()?'<i class="fas fa-file-archive fa-3x"></i>':'<i class="fas fa-file fa-3x"></i>'}function get_file_exact_size(e){let t=0;for(;e>900;)e/=1024,t++;return Math.round(100*e)/100+" "+["Bytes","KB","MB","GB"][t]}$(document).on("click",".btn-file-open",function(e){return dropzone_id_input=$(this).attr("input-id"),dropzone_file_folder=$(this).attr("data-folder"),$("#main").hide(100),$("#container-camera").hide(100),$("#container-filechooser").show(100),dropzone_reset("dropzone-xdxd","form_dropzone","form_folder"),e.preventDefault(),!1});